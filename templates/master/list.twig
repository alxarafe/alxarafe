{#
 ~ Alxarafe. Development of PHP applications in a flash!
 ~ Copyright (C) 2018 Alxarafe <info@alxarafe.com>
#}
{% extends "index.twig" %}

{% block title %}{{ lang.trans('list-of') }} {{ ctrl.title }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ view.getResourceUri('/css/common.css') }}">
{% endblock %}

{% block body %}
    {% import "master/autoforms.twig" as forms %}

    {% set encType = '' %}
    {% if ctrl.encType is not empty %}
        {% set encType = 'enctype="' ~ ctrl.encType ~ '"' %}
    {% endif %}
    <form action="{{ ctrl.url }}" method="post" accept-charset="utf-8" {{ encType }}>
        {% set baseLink = ctrl.url ~ '&' ~ constant('METHOD_CONTROLLER') %}
        {% set createLink = baseLink ~ '=create' ~ '&' ~ ctrl.model.getIdField() ~ '=' %}
        <div class="row">
            <div class="col-xs-6">
                <a name="cancel" class="btn btn-danger btn-sm" href="{{ constant('BASE_URI') }}/index.php">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="hidden-md">&nbsp;{{ lang.trans('back') }}</span>
                </a>
            </div>
                    <div class="col-xs-6 text-right">
                        {% for newButton in ctrl.newButtons %}
                <a href="{{ newButton.link }}" class="btn btn-{{ newButton.type }} btn-sm">
                    <span class="glyphicon {{newButton.icon}}" aria-hidden="true"></span>
                        <span class="hidden-md">&nbsp;{{ lang.trans(newButton.text)}}</span>
                    </a>
            {% endfor %}
            <a href="{{ createLink }}" class="btn btn-success btn-sm">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    <span class="hidden-md">&nbsp;{{ lang.trans('add-new') }}</span>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">&nbsp;</div>
        </div>
        <div class="row">
            <div class="col-md-12">
                {% set tableHeader = ctrl.getTableHeader() %}
                {% set tableBody = ctrl.getTableBody() %}
                {% set tableFooter = ctrl.getTableFooter() %}

                <div class="table-responsive ">
                    <table id="{{ ctrl.code }}" class="table table-hover table-striped table-bordered" align="center" style="width:100%">
                        <thead>
                            <tr>
                                {% for key, item in tableHeader %}
                                    {%  if key in ctrl.getDefaultColumnsSearch() %}
                                        <th
                                            {% if item.class is defined %} class="{{ item.class }}"{% endif %}
                                            {% if item.style is defined %} style="{{ item.style }}"{% endif %}
                                            >
                                            {{ item.label }}
                                        </th>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        </thead>
                        {#
                                            <tbody>
                                                {% for regKey, registers in tableBody %}
                                                    <tr id="row_{{ ctrl.tableName }}_{{ regKey }}">
                                                        {% set pkName = '' %}
                                                        {% set pkValue = '' %}
                                                        {% for itemKey, item in registers %}
                                                            {% if itemKey is same as(ctrl.model.getIdField()) %}
                                                                {% set pkName = itemKey %}
                                                                {% set pkValue = item.value %}
                                                            {% endif %}
                                                            <td id="cell_{{ ctrl.tableName }}_{{ itemKey }}_{{ regKey }}" {{ hidden }}
                                                                    {% if item.class is defined %} class="{{ item.class }}"{% endif %}
                                                                    {% if item.style is defined %} style="{{ item.style }}"{% endif %}
                                                            >
                                                                {{ forms.generateField(item, false, false, false) }}
                                                            </td>
                                                        {% endfor %}
                                                        <td class="text-right">
                                                            <div class="btn-group" role="group">
                                                                {% set idLink = '&' ~ pkName ~ '=' ~ pkValue %}
                                                                {% set showLink = baseLink ~ '=show' ~ idLink %}
                                                                {% set editLink = baseLink ~ '=edit' ~ idLink %}
                                                                {% set deleteLink = baseLink ~ '=delete' ~ idLink %}

                                                                {% if ctrl.canRead %}
                                                                    <a id="read_{{ key }}_{{ pos }}" name="read[]" class="btn btn-info btn-sm" type="button" href="{{ showLink }}">
                                                                        <span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>
                                                                        <span class="hidden-md">&nbsp;{{ lang.trans('show') }}</span>
                                                                    </a>
                                                                {% endif %}
                                                                {% if ctrl.canUpdate %}
                                                                    <a id="update_{{ key }}_{{ pos }}" name="update[]" class="btn btn-primary btn-sm" type="button" href="{{ editLink }}">
                                                                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                                                        <span class="hidden-md">&nbsp;{{ lang.trans('edit') }}</span>
                                                                    </a>
                                                                {% endif %}
                                                                {% if ctrl.canDelete %}
                                                                    <a id="delete_{{ key }}_{{ pos }}" name="delete[]" class="btn btn-danger btn-sm" type="button" href="{{ deleteLink }}">
                                                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                        <span class="hidden-md">&nbsp;{{ lang.trans('delete') }}</span>
                                                                    </a>
                                                                {% endif %}
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                    #}
                        {% if tableFooter is not empty %}
                            <tfoot>
                                <tr>
                                    {% for key, item in tableFooter %}
                                        {%  if key in ctrl.getDefaultColumnsSearch() %}
                                            <th
                                                {% if item.class is defined %} class="{{ item.class }}"{% endif %}
                                                {% if item.style is defined %} style="{{ item.style }}"{% endif %}
                                                >
                                                {{ item.label }}
                                            </th>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </tfoot>
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block javascriptsFooter %}
    {{ parent() }}
{% endblock %}